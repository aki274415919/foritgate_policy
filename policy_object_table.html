<!DOCTYPE html><html lang='ja'><head><meta charset='UTF-8'>
<title>FortiGateポリシービジュアライズ</title>

        <style>
        table { border-collapse: collapse; font-family: Consolas, monospace; font-size: 14px; min-width:1200px; }
        th, td { border: 1px solid #ccc; padding: 6px 10px; vertical-align: top; }
        th { background: #eee; font-weight: bold; }
        .object-branch { display:none; margin-top:6px; margin-left:6px; border-left:2px solid #999; padding-left:8px; background:#f9f9f9;}
        .object-level { margin-left:12px; }
        .cell-flex {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            align-items: center;
            min-width: 120px;
        }
        .obj-name { flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .toggle-btn { flex-shrink: 0; margin-left: 10px; color: blue; cursor: pointer; }
        .review-row {background:#f6f6fa;}
        .review-cell {padding:6px 4px 10px 4px; border-bottom:1px solid #eee;}
        .row-del {background: #ffdddd !important; color: red !important; text-decoration: line-through;}
        .row-mod {background: #fff7cc !important;}
        .warnbox {background:#ffeeee;border:2px solid #f44;padding:14px 16px;font-size:16px;margin:18px 0;}
        </style>
        
</head><body>
<div style='background:#eaffea;color:#097;padding:10px 18px;'>没有未定义对象，一切OK。</div>
<table>
<tr><th>id</th><th>name</th><th>action</th><th>status</th><th>srcintf</th><th>dstintf</th><th>srcaddr</th><th>dstaddr</th><th>service</th><th>schedule</th><th>logtraffic</th><th>comments</th><th>uuid</th><th>policyid</th><th>処理方法</th><th>コメント</th></tr>
<tr>
<td>1</td>
<td>Allow-Internet-to-Servers</td>
<td>accept</td>
<td></td>
<td>port1</td>
<td>port2</td>
<td><div class='cell-flex'>
                            <span class='obj-name'>all</span>
                            <span class='toggle-btn' onclick="toggleBranch('srcaddr-1-0')">[+]</span>
                        </div>
                        <div class='object-branch' id='srcaddr-1-0'>
                            <div class='object-level' style='color:green'><b>any</b></div>
                        </div></td>
<td><div class='cell-flex'>
                            <span class='obj-name'>App-Zone</span>
                            <span class='toggle-btn' onclick="toggleBranch('dstaddr-1-0')">[+]</span>
                        </div>
                        <div class='object-branch' id='dstaddr-1-0'>
                            <div class='object-level cell-flex' style='font-weight:bold;color:#148;'><span class='obj-name'>App-Zone <span style='color:#888'>(IPv4グループ)</span></span><span class='toggle-btn' onclick="toggleBranch('obj-addrgrp-App-Zone')">[+]</span></div><div class='object-branch' id='obj-addrgrp-App-Zone'><div class='object-level cell-flex' style='font-weight:bold;color:#148;'><span class='obj-name'>Server-Group <span style='color:#888'>(IPv4グループ)</span></span><span class='toggle-btn' onclick="toggleBranch('obj-addrgrp-Server-Group')">[+]</span></div><div class='object-branch' id='obj-addrgrp-Server-Group'><div class='object-level'>Web-Server-1 <span style='color:#999'>[ip]</span> 192.168.10.10/32 </div><div class='object-level'>Web-Server-2 <span style='color:#999'>[ip]</span> 192.168.10.11/32 </div></div><div class='object-level'>DB-Server <span style='color:#999'>[ip]</span> 192.168.20.10/32 </div></div>
                        </div></td>
<td><div class='cell-flex'>
                            <span class='obj-name'>Web-Services</span>
                            <span class='toggle-btn' onclick="toggleBranch('service-1-0')">[+]</span>
                        </div>
                        <div class='object-branch' id='service-1-0'>
                            <div class='object-level cell-flex' style='font-weight:bold;color:#148;'><span class='obj-name'>Web-Services <span style='color:#888'>(サービスグループ)</span></span><span class='toggle-btn' onclick="toggleBranch('obj-svcgrp-Web-Services')">[+]</span></div><div class='object-branch' id='obj-svcgrp-Web-Services'><div class='object-level'>My-HTTP <span style='color:#999'>[サービス]</span> </div><div class='object-level'>My-HTTPS <span style='color:#999'>[サービス]</span> </div></div>
                        </div></td>
<td>always</td>
<td>all</td>
<td></td>
<td></td>
<td></td>
<td class='review-cell'>
                <select class="review-action" data-id="1">
                  <option value="">--選択--</option>
                  <option value="allow">許可（残す）</option>
                  <option value="delete">削除</option>
                  <option value="modify">修正</option>
                </select>
            </td>
            <td class='review-cell'>
                <input class="review-comment" data-id="1" placeholder="理由や補足" style="width:120px">
            </td>
</tr>
</table>

    <button id="big-submit" style="width:92%;height:40px;font-size:1.3em;margin:30px 4%;">全ての処理内容を提出する</button>
    <script>
    function toggleBranch(id) {
        var div = document.getElementById(id);
        if (div.style.display === 'none' || div.style.display === '') {
            div.style.display = 'block';
        } else {
            div.style.display = 'none';
        }
    }
    let review_result = {};
    document.querySelectorAll('.review-action').forEach(sel => {
        sel.onchange = function() {
            let pid = this.getAttribute('data-id');
            review_result[pid] = review_result[pid] || {};
            review_result[pid].action = this.value;
        }
    });
    document.querySelectorAll('.review-comment').forEach(inp => {
        inp.oninput = function() {
            let pid = this.getAttribute('data-id');
            review_result[pid] = review_result[pid] || {};
            review_result[pid].comment = this.value;
        }
    });
    document.getElementById('big-submit').onclick = function() {
        let pageStyle = `
        <style>
        table { border-collapse: collapse; font-family: Consolas, monospace; font-size: 14px; min-width:1200px; }
        th, td { border: 1px solid #ccc; padding: 6px 10px; vertical-align: top; }
        th { background: #eee; font-weight: bold; }
        .object-branch { display:none; margin-top:6px; margin-left:6px; border-left:2px solid #999; padding-left:8px; background:#f9f9f9;}
        .object-level { margin-left:12px; }
        .cell-flex {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            align-items: center;
            min-width: 120px;
        }
        .obj-name { flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .toggle-btn { flex-shrink: 0; margin-left: 10px; color: blue; cursor: pointer; }
        .review-row {background:#f6f6fa;}
        .review-cell {padding:6px 4px 10px 4px; border-bottom:1px solid #eee;}
        .row-del {background: #ffdddd !important; color: red !important; text-decoration: line-through;}
        .row-mod {background: #fff7cc !important;}
        .warnbox {background:#ffeeee;border:2px solid #f44;padding:14px 16px;font-size:16px;margin:18px 0;}
        </style>
        `;
        let table = document.querySelector("table").cloneNode(true);
        if (table.rows.length > 0 && table.rows[0].cells.length > 0) {
            table.rows[0].deleteCell(-1);
            table.rows[0].deleteCell(-1);
            let th1 = document.createElement("th");
            th1.textContent = "判定";
            table.rows[0].appendChild(th1);
            let th2 = document.createElement("th");
            th2.textContent = "コメント";
            table.rows[0].appendChild(th2);
        }
        for (let i = 1; i < table.rows.length; ++i) {
            let row = table.rows[i];
            let pid = row.cells[0].textContent.trim();
            let result = review_result[pid] || {};
            let action = result.action || '';
            let comment = result.comment || '';
            row.deleteCell(-1);
            row.deleteCell(-1);
            let td1 = document.createElement("td");
            td1.textContent = (
                action=="allow" ? "許可" : action=="delete" ? "削除" : action=="modify" ? "修正" : ""
            );
            row.appendChild(td1);
            let td2 = document.createElement("td");
            td2.textContent = comment;
            row.appendChild(td2);
            if(action=="delete") {
                row.classList.add("row-del");
            } else if(action=="modify") {
                row.classList.add("row-mod");
            }
        }
        alert("新しいウィンドウで右クリックして『印刷』を選び、PDFとして保存してお願いします。");
        let result_html = "<!DOCTYPE html><html><head><meta charset='utf-8'><title>批判結果付きポリシー表</title>";
        result_html += pageStyle + "</head><body>";
        result_html += "<h2>批判処理結果付きポリシー一覧</h2>";
        result_html += table.outerHTML;
        result_html += "</body></html>";
        let w = window.open();
        w.document.write(result_html);
        w.document.close();
    };
    </script>
    